---
title: "Problem Set 1"
author: "Michael Fryer"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(rethinking)
```

## 1. COVID Home Test

In a clinical trial, the BinaxNOW home COVID-19 antigen test correctly gave a positive result 75.5% of the time and correctly gave a negative result 99.5% of the time. For the next set of questions, assume that presence of the antigen suﬀices for a person to have COVID-19 and absence of the antigen suﬀices for that person to not have COVID-19. Finally, assume that 10% of the people in your community are currently infected with COVID-19. (This is your base rate for exposure.)

```{r}
# Data from above
p_infected <- 0.1

sensitivity_binax <- 0.755
specificity_binax <- 0.995
```

\textit{Let's prepare some helper functions we will use later.}
```{r}
bayes <- function(base_rate, sensitivity, specificity) {
  p_evidence <- (sensitivity * base_rate) + ((1 - specificity) * (1 - base_rate))
  return((sensitivity * base_rate) / p_evidence)
}
```

**a)** Suppose you take a BimaxNOW COVID-19 antigen test. What is the probability of an administered BinaxNOW test returning to you a positive result?

\textit{The probability of an administered BinaxNOW test returning to you a positive result is equal to $P(T=1) = P(T=1|C=1)P(C=1) + P(T=1|C=0)P(C=0)$ where $T$ refers to the test result and $C$ refers to the presence of the antigen.}
```{r}
p_pos <- (
  sensitivity_binax * p_infected + (1 - specificity_binax) * (1 - p_infected)
)
```
```{r, echo=FALSE}
cat("Probability of getting a positive result: ", p_pos)
```

**b)** Suppose the infection rate in New Zealand is 1.5% and a New Zealander takes a BinaxNOW test. What is the probability that this test will return a positive result?

\textit{This is the same as above, however we use different values for our base rate.}
```{r}
p_infected_nz <- 0.015

p_pos <- (
  sensitivity_binax * p_infected_nz + (1 - specificity_binax) * (1 - p_infected_nz)
)
```
```{r, echo=FALSE}
cat("Probability of getting a positive result (in New Zealand): ", p_pos)
```

**c)** A competitor offers a test with a sensitivity 90% but specificity 99.0% (vs BinaxNOW’s 99.5%).

-   Calculate $P(C=1|T=1)$ for both tests.
```{r}
sensitivity_competitor <- .9
specificity_competitor <- .99

# BinaxNOW
p_infected_g_pos_binax <- bayes(
  p_infected, sensitivity_binax, specificity_binax
)

# Competitor
p_infected_g_pos_c <- bayes(
  p_infected, sensitivity_competitor, specificity_competitor
)
```
```{r, echo=FALSE}
cat("P(C=1|T=1):\n")
cat("BinaxNow:   ", p_infected_g_pos_binax, "\n")
cat("Competitor: ", p_infected_g_pos_c)
```

-   The competitor’s test costs 2x more. For which base rates (if any) would you prefer the competitor’s test?

\textit{The base rates you would prefer are the ones wherein testing with a single competitor's test out performs testing twice with BinaxNOW. That is, the base rates where $P(C=1|T=1)$ is higher for the competitor when testing with at most 2 BinaxNOW tests.}

-   Plot $P(C=1|T=1)$ vs base rate for both tests on the same graph.
```{r}
num_rates <- 1000
base_rates <- seq(from=0, to=0.25, length.out=num_rates)

# BinaxNOW
binax_rates <- rep(NA, num_rates)
for (i in 1:num_rates) {
  binax_rates[i] <- bayes(base_rates[i], sensitivity_binax, specificity_binax)
}

# Competitor
competitor_rates <- rep(NA, num_rates)
for (i in 1:num_rates) {
  competitor_rates[i] <- bayes(
    base_rates[i], sensitivity_competitor, specificity_competitor
  )
}
```
```{r, echo=FALSE}
plot(base_rates,
     binax_rates,
     type="l", 
     col="red",
     xlab="Base Rate",
     ylab="Prob Covid given Positive Test"
)
lines(base_rates, competitor_rates, type="l", col="blue")
legend("bottomright",
       legend=c("BinaxNOW", "Competitor"),
       col=c("red", "blue"),
       pch=c(15, 15)
)
```

-   Write 2-3 sentences explaining at which base rates each test is preferable and why the preference changes (or doesn’t change).

\textit{Within the context of covid, we would prefer the BinaxNOW test for all base rates. Compared to the competitor, BinaxNOW is more accurate at determining an infected individual (red line is "above" the blue line).}

**d)** Suppose the competitor offers a second generation test to you with a sensitivity 82% and specificity 99.7%.

-   Calculate $P(C=1|T=1)$ for BinaxNOW vs the competitor’s generation 2 test.
```{r}
sensitivity_competitor <- .82
specificity_competitor <- .997

# BinaxNOW
p_infected_g_pos_binax <- bayes(
  p_infected, sensitivity_binax, specificity_binax
)

# Competitor
p_infected_g_pos_c <- bayes(
  p_infected, sensitivity_competitor, specificity_competitor
)
```
```{r, echo=FALSE}
cat("P(C=1|T=1):\n")
cat("BinaxNow:   ", p_infected_g_pos_binax, "\n")
cat("Competitor: ", p_infected_g_pos_c)
```
-   The competitor’s new test also costs 2x more than BinaxNOW. For which base rates (if any) would you prefer the competitor’s new test?

\textit{The same argument applies here as in \textbf{c)} from above. That is, when two or less BinaxNOW tests out perform a single competitor's test.}

-   Plot $P(C=1|T=1)$ vs base rate for both tests on the same graph.
```{r}
num_rates <- 1000
base_rates <- seq(from=0, to=0.25, length.out=num_rates)

# BinaxNOW
binax_rates <- rep(NA, num_rates)
for (i in 1:num_rates) {
  binax_rates[i] <- bayes(base_rates[i], sensitivity_binax, specificity_binax)
}

# Competitor
competitor_rates <- rep(NA, num_rates)
for (i in 1:num_rates) {
  competitor_rates[i] <- bayes(
    base_rates[i], sensitivity_competitor, specificity_competitor
  )
}
```
```{r, echo=FALSE}
plot(base_rates,
     binax_rates,
     type="l", 
     col="red",
     xlab="Base Rate",
     ylab="Prob Covid given Positive Test"
)
lines(base_rates, competitor_rates, type="l", col="blue")
legend("bottomright",
       legend=c("BinaxNOW", "Competitor"),
       col=c("red", "blue"),
       pch=c(15, 15)
)
```

-   Write 2-3 sentences explaining at which base rates each test is preferable and why the preference changes (or doesn’t change).

\textit{Unlike \textbf{c)} from above, and barring monetary concern, the competitor is prefered at all base rate values. The same argument applies here as above, that being blue above red.}

## 2. Computing Probabilities

Implement and run the following chunk of code to create a distribution, samples. Create a plot of that distribution. Then, where called for, write a short line of R code to compute an answer to each question. Analytical solutions will not be accepted.

``` r
p_grid <- seq( from=0 , to=1, length.out=1000)
prior <- rep(1, 1000)
likelihood <- dbinom( 6, size=10 , prob=p_grid )
posterior <- likelihood * prior
posterior <- posterior / sum(posterior)
set.seed(712)
samples <- sample( p_grid , prob=posterior , size=1e4, replace=TRUE )
```

**a)** How much posterior probability lies below $p = 0.5$?

**b)** How much posterior probability lies above $p = 0.8$?

**c)** How much posterior probability likes between $p = 0.2$ and $p = 0.8$?

**d)** 20% of the posterior probability likes below which value of $p$?

## 3. Swing Voters

Write your own R code chunks to answer the following questions. Analytical solutions will not suﬀice.

**a)** Imagine a country where there are only two political parties, Red and Blue, which divide the electorate equally. One difference between registered Blue voters and registered Red voters is their willingness to vote for the opposing party’s candidate. Blue voters vote Red 20% of the time, otherwise they vote Blue. Red voters vote Blue 10% of the time, otherwise they vote Red. Voters who switch are called swing voters.

Smith was a swing voter in the last election but you do not know whether he is Red or Blue. (Nobody changes parties.) What is the probability that Smith will be a swing voter in the next election? Explain your reasoning. Assume the prior probability of a person being in Blue is 0.265.

**b)** Now imagine a country where there are three political parties: Red, Blue, and Green. Red voters vote Blue 10% of the time, vote for Green 5% of the time, and vote their own party, Red, 85% of the time. Blue voters vote Red 15% of the time, Green 5% of the time, and their own party the remaining 80% of the time. Finally, Green votes Blue 20% of the time, Red 10% of the time, and Green the remainder. The electorate is evenly among the three parties.

What is the probability that a swing voter in the last election between Red, Blue, and Green, will be a swing voter in the next election? (Like before, nobody changes parties.) Explain your reasoning.

## 4. Reflection

Look back at problems 1 to 3. In each case, you updated beliefs based on observations:

-   In problem 1, test result $\rightarrow$ disease status.
-   In problem 2, data $\rightarrow$ parameter value.
-   In problem 3, past behavior $\rightarrow$ future behavior.

Write a 3-4 sentence paragraph explaining what these three problems have in common from a Bayesian perspective. What role do priors play in each?

## 5. AI Declaration

Please declare your collaborators in the class and how you used AI (if at all) to complete this assignment. If you used AI, include the prompts you used and explain what you learned from its responses that you didn’t understand initially.
